============================= test session starts ==============================
platform darwin -- Python 3.12.1, pytest-8.0.1, pluggy-1.4.0
rootdir: /Users/daniedagot/Downloads/sympoly-assignment
plugins: asyncio-0.23.5, bdd-7.0.1, anyio-4.2.0
asyncio: mode=Mode.STRICT
collected 1 item

tests/test_api.py F

=================================== FAILURES ===================================
___________________________ test_populate_must_work ____________________________

client_test = <async_generator object client_test at 0x1083d6dc0>

    @pytest.mark.asyncio
    async def test_populate_must_work(client_test):
        # Assuming the fixture correctly sets up and yields an AsyncClient instance
        client = await client_test.__anext__()
>       response = await client.get("/invoices")

tests/test_api.py:86: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1801: in get
    return await self.request(
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1574: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1661: in send
    response = await self._send_handling_auth(
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1689: in _send_handling_auth
    response = await self._send_handling_redirects(
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1726: in _send_handling_redirects
    response = await self._send_single_request(request)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1763: in _send_single_request
    response = await transport.handle_async_request(request)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_transports/asgi.py:164: in handle_async_request
    await self.app(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/applications.py:123: in __call__
    await self.middleware_stack(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app
    raise exc
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    await app(scope, receive, sender)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/routing.py:758: in __call__
    await self.middleware_stack(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/routing.py:778: in app
    await route.handle(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/routing.py:299: in handle
    await self.app(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/routing.py:79: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app
    raise exc
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    await app(scope, receive, sender)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/starlette/routing.py:74: in app
    response = await func(request)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/routing.py:299: in app
    raise e
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/routing.py:294: in app
    raw_response = await run_endpoint_function(
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
routes/invoices.py:54: in get_invoices
    invoices = await Invoice.find_all().to_list()
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/interfaces/find.py:351: in find_all
    return cls.find_many(
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/interfaces/find.py:197: in find_many
    args = cls._add_class_id_filter(args, with_children)
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/interfaces/find.py:447: in _add_class_id_filter
    if any(
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/interfaces/find.py:451: in <genexpr>
    if isinstance(a, Iterable) and cls.get_settings().class_id in a
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'database.Invoice'>

    @classmethod
    def get_settings(cls) -> DocumentSettings:
        """
        Get document settings, which was created on
        the initialization step
    
        :return: DocumentSettings class
        """
        if cls._document_settings is None:
>           raise CollectionWasNotInitialized
E           beanie.exceptions.CollectionWasNotInitialized

../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/documents.py:1084: CollectionWasNotInitialized
=============================== warnings summary ===============================
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/fields.py:584
  /Users/daniedagot/Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/fields.py:584: DeprecationWarning: `general_plain_validator_function` is deprecated, use `with_info_plain_validator_function` instead.
    return core_schema.general_plain_validator_function(validate)

../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/pydantic_core/core_schema.py:3953
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/pydantic_core/core_schema.py:3953
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/pydantic_core/core_schema.py:3953
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/pydantic_core/core_schema.py:3953
  /Users/daniedagot/Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/pydantic_core/core_schema.py:3953: DeprecationWarning: `general_plain_validator_function` is deprecated, use `with_info_plain_validator_function` instead.
    warnings.warn(

../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/fields.py:150
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/fields.py:150
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/fields.py:150
  /Users/daniedagot/Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/beanie/odm/fields.py:150: DeprecationWarning: `general_plain_validator_function` is deprecated, use `with_info_plain_validator_function` instead.
    python_schema=core_schema.general_plain_validator_function(

database.py:41
  /Users/daniedagot/Downloads/sympoly-assignment/database.py:41: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/applications.py:4495
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/applications.py:4495
../../Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/applications.py:4495
  /Users/daniedagot/Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

database.py:48
  /Users/daniedagot/Downloads/sympoly-assignment/database.py:48: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

main.py:56
  /Users/daniedagot/Downloads/sympoly-assignment/main.py:56: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app_.on_event("startup")

tests/test_api.py::test_populate_must_work
  /Users/daniedagot/Library/Caches/pypoetry/virtualenvs/sympoly-assignment-umcUDZET-py3.12/lib/python3.12/site-packages/httpx/_client.py:1426: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=ASGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_api.py::test_populate_must_work - beanie.exceptions.Collect...
======================== 1 failed, 15 warnings in 0.53s ========================
